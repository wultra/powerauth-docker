version: '2.4'
services:

    # PowerAuth Server PostgreSQL Database
    powerauth-server-postgresql:
        image: powerauth/server-postgresql
        container_name: powerauth-server-postgresql
        ports:
            - "23316:5432"
        environment:
            - POSTGRES_PASSWORD=${POWERAUTH_POSTGRESQL_PASSWORD}
        volumes:
            - ${POWERAUTH_POSTGRESQL_PATH}:/var/lib/postgresql
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U powerauth"]
            interval: 5s
            timeout: 5s
            retries: 30

    # PowerAuth Push Server PostgreSQL Database
    powerauth-push-postgresql:
        image: powerauth/push-postgresql
        container_name: powerauth-push-postgresql
        ports:
            - "23336:5432"
        environment:
            - POSTGRES_PASSWORD=${POWERAUTH_PUSH_POSTGRESQL_PASSWORD}
        volumes:
            - ${POWERAUTH_PUSH_POSTGRESQL_PATH}:/var/lib/postgresql
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U powerauth"]
            interval: 5s
            timeout: 5s
            retries: 30

    # PowerAuth WebFlow PostgreSQL Database
    powerauth-webflow-postgresql:
        image: powerauth/webflow-postgresql
        container_name: powerauth-webflow-postgresql
        ports:
            - "23376:5432"
        environment:
            - POSTGRES_PASSWORD=${POWERAUTH_WEBFLOW_POSTGRESQL_PASSWORD}
        volumes:
            - ${POWERAUTH_WEBFLOW_POSTGRESQL_PATH}:/var/lib/postgresql
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U powerauth"]
            interval: 5s
            timeout: 5s
            retries: 30

    # PowerAuth Server
    powerauth-java-server:
        image: powerauth/server-arm64v8
        container_name: powerauth-server
        ports:
            - "20010:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-java-server"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - POWERAUTH_SERVER_DATASOURCE_URL=${POWERAUTH_SERVER_DATASOURCE_URL}
            - POWERAUTH_SERVER_DATASOURCE_USERNAME=${POWERAUTH_SERVER_DATASOURCE_USERNAME}
            - POWERAUTH_SERVER_DATASOURCE_PASSWORD=${POWERAUTH_SERVER_DATASOURCE_PASSWORD}
            - POWERAUTH_SERVER_DATASOURCE_DRIVER=${POWERAUTH_SERVER_DATASOURCE_DRIVER}
            - POWERAUTH_SERVER_JPA_DDL_AUTO=${POWERAUTH_SERVER_JPA_DDL_AUTO}
            - POWERAUTH_SERVER_JPA_CHARSET=${POWERAUTH_SERVER_JPA_CHARSET}
            - POWERAUTH_SERVER_JPA_CHARACTER_ENCODING=${POWERAUTH_SERVER_JPA_CHARACTER_ENCODING}
            - POWERAUTH_SERVER_JPA_USE_UNICODE=${POWERAUTH_SERVER_JPA_USE_UNICODE}
            - POWERAUTH_SERVER_JPA_DATABASE_PLATFORM=${POWERAUTH_SERVER_JPA_DATABASE_PLATFORM}
            - POWERAUTH_SERVER_JPA_LOCK_TIMEOUT=${POWERAUTH_SERVER_JPA_LOCK_TIMEOUT}
            - POWERAUTH_SERVER_DATASOURCE_JNDI_NAME=${POWERAUTH_SERVER_DATASOURCE_JNDI_NAME}
            - POWERAUTH_SERVER_SPRING_JMX_ENABLED=${POWERAUTH_SERVER_SPRING_JMX_ENABLED}
            - POWERAUTH_SERVER_SPRING_JMX_DEFAULT_DOMAIN=${POWERAUTH_SERVER_SPRING_JMX_DEFAULT_DOMAIN}
            - POWERAUTH_SERVER_HTTP_PROXY_ENABLED=${POWERAUTH_SERVER_HTTP_PROXY_ENABLED}
            - POWERAUTH_SERVER_HTTP_PROXY_HOST=${POWERAUTH_SERVER_HTTP_PROXY_HOST}
            - POWERAUTH_SERVER_HTTP_PROXY_PORT=${POWERAUTH_SERVER_HTTP_PROXY_PORT}
            - POWERAUTH_SERVER_HTTP_PROXY_USERNAME=${POWERAUTH_SERVER_HTTP_PROXY_USERNAME}
            - POWERAUTH_SERVER_HTTP_PROXY_PASSWORD=${POWERAUTH_SERVER_HTTP_PROXY_PASSWORD}
            - POWERAUTH_SERVER_HTTP_CONNECTION_TIMEOUT=${POWERAUTH_SERVER_HTTP_CONNECTION_TIMEOUT}
            - POWERAUTH_SERVER_TOKEN_TIMESTAMP_VALIDITY=${POWERAUTH_SERVER_TOKEN_TIMESTAMP_VALIDITY}
            - POWERAUTH_SERVER_RESTRICT_ACCESS=${POWERAUTH_SERVER_RESTRICT_ACCESS}
            - POWERAUTH_SERVER_RECOVERY_MAX_FAILED_ATTEMPTS=${POWERAUTH_SERVER_RECOVERY_MAX_FAILED_ATTEMPTS}
            - POWERAUTH_SERVER_MASTER_DB_ENCRYPTION_KEY=${POWERAUTH_SERVER_MASTER_DB_ENCRYPTION_KEY}
            - POWERAUTH_SERVER_SECURE_VAULT_ENABLE_BIOMETRY=${POWERAUTH_SERVER_SECURE_VAULT_ENABLE_BIOMETRY}
            - POWERAUTH_SERVER_APPLICATION_NAME=${POWERAUTH_SERVER_APPLICATION_NAME}
            - POWERAUTH_SERVER_APPLICATION_DISPLAY_NAME=${POWERAUTH_SERVER_APPLICATION_DISPLAY_NAME}
            - POWERAUTH_SERVER_APPLICATION_ENVIRONMENT=${POWERAUTH_SERVER_APPLICATION_ENVIRONMENT}
            - POWERAUTH_SERVER_CORRELATION_HEADER_ENABLED=${POWERAUTH_SERVER_CORRELATION_HEADER_ENABLED}
            - POWERAUTH_SERVER_CORRELATION_HEADER_NAME=${POWERAUTH_SERVER_CORRELATION_HEADER_NAME}
            - POWERAUTH_SERVER_CORRELATION_HEADER_VALUE_VALIDATION_REGEXP=${POWERAUTH_SERVER_CORRELATION_HEADER_VALUE_VALIDATION_REGEXP}
            - POWERAUTH_SERVER_LOGGING=${POWERAUTH_SERVER_LOGGING}
            - POWERAUTH_ADMIN_POWERAUTH_SERVICE_URL=${POWERAUTH_ADMIN_POWERAUTH_SERVICE_URL}
            - POWERAUTH_ADMIN_SECURITY_CLIENT_TOKEN=${POWERAUTH_ADMIN_SECURITY_CLIENT_TOKEN}
            - POWERAUTH_ADMIN_SECURITY_CLIENT_SECRET=${POWERAUTH_ADMIN_SECURITY_CLIENT_SECRET}
            - POWERAUTH_ADMIN_ACCEPT_INVALID_SSL_CERTIFICATE=${POWERAUTH_ADMIN_ACCEPT_INVALID_SSL_CERTIFICATE}
            - POWERAUTH_ADMIN_SECURITY_METHOD=${POWERAUTH_ADMIN_SECURITY_METHOD}
            - POWERAUTH_ADMIN_LDAP_USER_DN_PATTERNS=${POWERAUTH_ADMIN_LDAP_USER_DN_PATTERNS}
            - POWERAUTH_ADMIN_LDAP_USER_SEARCH_BASE=${POWERAUTH_ADMIN_LDAP_USER_SEARCH_BASE}
            - POWERAUTH_ADMIN_LDAP_USER_SEARCH_FILTER=${POWERAUTH_ADMIN_LDAP_USER_SEARCH_FILTER}
            - POWERAUTH_ADMIN_LDAP_GROUP_SEARCH_BASE=${POWERAUTH_ADMIN_LDAP_GROUP_SEARCH_BASE}
            - POWERAUTH_ADMIN_LDAP_GROUP_SEARCH_FILTER=${POWERAUTH_ADMIN_LDAP_GROUP_SEARCH_FILTER}
            - POWERAUTH_ADMIN_LDAP_GROUP_ROLE_ATTRIBUTE=${POWERAUTH_ADMIN_LDAP_GROUP_ROLE_ATTRIBUTE}
            - POWERAUTH_ADMIN_LDAP_URL=${POWERAUTH_ADMIN_LDAP_URL}
            - POWERAUTH_ADMIN_LDAP_PORT=${POWERAUTH_ADMIN_LDAP_PORT}
            - POWERAUTH_ADMIN_LDAP_ROOT=${POWERAUTH_ADMIN_LDAP_ROOT}
            - POWERAUTH_ADMIN_LDAP_LDIF=${POWERAUTH_ADMIN_LDAP_LDIF}
            - POWERAUTH_ADMIN_LDAP_MANAGER_DN=${POWERAUTH_ADMIN_LDAP_MANAGER_DN}
            - POWERAUTH_ADMIN_LDAP_MANAGER_PASSWORD=${POWERAUTH_ADMIN_LDAP_MANAGER_PASSWORD}
            - POWERAUTH_ADMIN_AD_DOMAIN=${POWERAUTH_ADMIN_AD_DOMAIN}
            - POWERAUTH_ADMIN_AD_URL=${POWERAUTH_ADMIN_AD_URL}
            - POWERAUTH_ADMIN_AD_ROOT=${POWERAUTH_ADMIN_AD_ROOT}
            - POWERAUTH_ADMIN_AD_USER_SEARCH_FILTER=${POWERAUTH_ADMIN_AD_USER_SEARCH_FILTER}
            - POWERAUTH_ADMIN_APPLICATION_NAME=${POWERAUTH_ADMIN_APPLICATION_NAME}
            - POWERAUTH_ADMIN_APPLICATION_DISPLAY_NAME=${POWERAUTH_ADMIN_APPLICATION_DISPLAY_NAME}
            - POWERAUTH_ADMIN_APPLICATION_ENVIRONMENT=${POWERAUTH_ADMIN_APPLICATION_ENVIRONMENT}
            - POWERAUTH_ADMIN_LOGGING=${POWERAUTH_ADMIN_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-server-postgresql:
                condition: service_healthy

    # PowerAuth Push Server
    powerauth-push-server:
        image: powerauth/push-server-arm64v8
        container_name: powerauth-push-server
        ports:
            - "20030:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-push-server"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - PUSH_SERVER_POWERAUTH_SERVICE_URL=${PUSH_SERVER_POWERAUTH_SERVICE_URL}
            - PUSH_SERVER_PUSH_SERVICE_URL=${PUSH_SERVER_PUSH_SERVICE_URL}
            - PUSH_SERVER_SECURITY_CLIENT_TOKEN=${PUSH_SERVER_SECURITY_CLIENT_TOKEN}
            - PUSH_SERVER_SECURITY_CLIENT_SECRET=${PUSH_SERVER_SECURITY_CLIENT_SECRET}
            - PUSH_SERVER_ACCEPT_INVALID_SSL_CERTIFICATE=${PUSH_SERVER_ACCEPT_INVALID_SSL_CERTIFICATE}
            - PUSH_SERVER_DATASOURCE_URL=${PUSH_SERVER_DATASOURCE_URL}
            - PUSH_SERVER_DATASOURCE_USERNAME=${PUSH_SERVER_DATASOURCE_USERNAME}
            - PUSH_SERVER_DATASOURCE_PASSWORD=${PUSH_SERVER_DATASOURCE_PASSWORD}
            - PUSH_SERVER_DATASOURCE_DRIVER=${PUSH_SERVER_DATASOURCE_DRIVER}
            - PUSH_SERVER_JPA_DDL_AUTO=${PUSH_SERVER_JPA_DDL_AUTO}
            - PUSH_SERVER_JPA_CHARSET=${PUSH_SERVER_JPA_CHARSET}
            - PUSH_SERVER_JPA_CHARACTER_ENCODING=${PUSH_SERVER_JPA_CHARACTER_ENCODING}
            - PUSH_SERVER_JPA_USE_UNICODE=${PUSH_SERVER_JPA_USE_UNICODE}
            - PUSH_SERVER_JPA_DATABASE_PLATFORM=${PUSH_SERVER_JPA_DATABASE_PLATFORM}
            - PUSH_SERVER_APNS_DEVELOPMENT=${PUSH_SERVER_APNS_DEVELOPMENT}
            - PUSH_SERVER_APNS_PROXY_ENABLED=${PUSH_SERVER_APNS_PROXY_ENABLED}
            - PUSH_SERVER_APNS_PROXY_HOST=${PUSH_SERVER_APNS_PROXY_HOST}
            - PUSH_SERVER_APNS_PROXY_PORT=${PUSH_SERVER_APNS_PROXY_PORT}
            - PUSH_SERVER_APNS_PROXY_USERNAME=${PUSH_SERVER_APNS_PROXY_USERNAME}
            - PUSH_SERVER_APNS_PROXY_PASSWORD=${PUSH_SERVER_APNS_PROXY_PASSWORD}
            - PUSH_SERVER_FCM_PROXY_ENABLED=${PUSH_SERVER_FCM_PROXY_ENABLED}
            - PUSH_SERVER_FCM_PROXY_HOST=${PUSH_SERVER_FCM_PROXY_HOST}
            - PUSH_SERVER_FCM_PROXY_PORT=${PUSH_SERVER_FCM_PROXY_PORT}
            - PUSH_SERVER_FCM_PROXY_USERNAME=${PUSH_SERVER_FCM_PROXY_USERNAME}
            - PUSH_SERVER_FCM_PROXY_PASSWORD=${PUSH_SERVER_FCM_PROXY_PASSWORD}
            - PUSH_SERVER_FCM_DATA_NOTIFICATION_ONLY=${PUSH_SERVER_FCM_DATA_NOTIFICATION_ONLY}
            - PUSH_SERVER_DATASOURCE_JNDI_NAME=${PUSH_SERVER_DATASOURCE_JNDI_NAME}
            - PUSH_SERVER_CAMPAIGN_BATCH_SIZE=${PUSH_SERVER_CAMPAIGN_BATCH_SIZE}
            - PUSH_SERVER_MESSAGE_STORAGE_ENABLED=${PUSH_SERVER_MESSAGE_STORAGE_ENABLED}
            - PUSH_SERVER_REGISTRATION_MULTIPLE_ACTIVATIONS_ENABLED=${PUSH_SERVER_REGISTRATION_MULTIPLE_ACTIVATIONS_ENABLED}
            - PUSH_SERVER_SPRING_BATCH_JOB_ENABLED=${PUSH_SERVER_SPRING_BATCH_JOB_ENABLED}
            - PUSH_SERVER_SPRING_JMX_ENABLED=${PUSH_SERVER_SPRING_JMX_ENABLED}
            - PUSH_SERVER_SPRING_JMX_DEFAULT_DOMAIN=${PUSH_SERVER_SPRING_JMX_DEFAULT_DOMAIN}
            - PUSH_SERVER_FCM_CONNECT_TIMEOUT=${PUSH_SERVER_FCM_CONNECT_TIMEOUT}
            - PUSH_SERVER_APNS_CONNECT_TIMEOUT=${PUSH_SERVER_APNS_CONNECT_TIMEOUT}
            - PUSH_SERVER_APNS_IDLE_PING_INTERVAL=${PUSH_SERVER_APNS_IDLE_PING_INTERVAL}
            - PUSH_SERVER_APNS_CONCURRENT_CONNECTIONS=${PUSH_SERVER_APNS_CONCURRENT_CONNECTIONS}
            - PUSH_SERVER_JAVA_CACERTS_PASSWORD=${PUSH_SERVER_JAVA_CACERTS_PASSWORD}
            - PUSH_SERVER_APPLICATION_NAME=${PUSH_SERVER_APPLICATION_NAME}
            - PUSH_SERVER_APPLICATION_DISPLAY_NAME=${PUSH_SERVER_APPLICATION_DISPLAY_NAME}
            - PUSH_SERVER_APPLICATION_ENVIRONMENT=${PUSH_SERVER_APPLICATION_ENVIRONMENT}
            - PUSH_SERVER_CORRELATION_HEADER_ENABLED=${POWERAUTH_SERVER_CORRELATION_HEADER_ENABLED}
            - PUSH_SERVER_CORRELATION_HEADER_NAME=${POWERAUTH_SERVER_CORRELATION_HEADER_NAME}
            - PUSH_SERVER_CORRELATION_HEADER_VALUE_VALIDATION_REGEXP=${POWERAUTH_SERVER_CORRELATION_HEADER_VALUE_VALIDATION_REGEXP}
            - PUSH_SERVER_LOGGING=${PUSH_SERVER_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-push-postgresql:
                condition: service_healthy
            powerauth-java-server:
                condition: service_healthy

    # PowerAuth NextStep Server
    powerauth-nextstep:
        image: powerauth/nextstep-arm64v8
        container_name: powerauth-nextstep
        ports:
            - "13010:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-nextstep"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - NEXTSTEP_DATA_ADAPTER_URL=${NEXTSTEP_DATA_ADAPTER_URL}
            - NEXTSTEP_POWERAUTH_SERVICE_URL=${NEXTSTEP_POWERAUTH_SERVICE_URL}
            - NEXTSTEP_POWERAUTH_SECURITY_TOKEN=${NEXTSTEP_POWERAUTH_SECURITY_TOKEN}
            - NEXTSTEP_POWERAUTH_SECURITY_SECRET=${NEXTSTEP_POWERAUTH_SECURITY_SECRET}
            - NEXTSTEP_ACCEPT_INVALID_SSL_CERTIFICATE=${NEXTSTEP_ACCEPT_INVALID_SSL_CERTIFICATE}
            - NEXTSTEP_DATASOURCE_URL=${NEXTSTEP_DATASOURCE_URL}
            - NEXTSTEP_DATASOURCE_USERNAME=${NEXTSTEP_DATASOURCE_USERNAME}
            - NEXTSTEP_DATASOURCE_PASSWORD=${NEXTSTEP_DATASOURCE_PASSWORD}
            - NEXTSTEP_DATASOURCE_DRIVER=${NEXTSTEP_DATASOURCE_DRIVER}
            - NEXTSTEP_JPA_DDL_AUTO=${NEXTSTEP_JPA_DDL_AUTO}
            - NEXTSTEP_JPA_CHARSET=${NEXTSTEP_JPA_CHARSET}
            - NEXTSTEP_JPA_CHARACTER_ENCODING=${NEXTSTEP_JPA_CHARACTER_ENCODING}
            - NEXTSTEP_JPA_USE_UNICODE=${NEXTSTEP_JPA_USE_UNICODE}
            - NEXTSTEP_JPA_DATABASE_PLATFORM=${NEXTSTEP_JPA_DATABASE_PLATFORM}
            - NEXTSTEP_OPERATION_EXPIRATION_TIME=${NEXTSTEP_OPERATION_EXPIRATION_TIME}
            - NEXTSTEP_POWERAUTH_OPERATIONS_ENABLED=${NEXTSTEP_POWERAUTH_OPERATIONS_ENABLED}
            - NEXTSTEP_E2E_ENCRYPTION_KEY=${NEXTSTEP_E2E_ENCRYPTION_KEY}
            - NEXTSTEP_MASTER_DB_ENCRYPTION_KEY=${NEXTSTEP_MASTER_DB_ENCRYPTION_KEY}
            - NEXTSTEP_DATASOURCE_JNDI_NAME=${NEXTSTEP_DATASOURCE_JNDI_NAME}
            - NEXTSTEP_SPRING_JMX_ENABLED=${NEXTSTEP_SPRING_JMX_ENABLED}
            - NEXTSTEP_SPRING_JMX_DEFAULT_DOMAIN=${NEXTSTEP_SPRING_JMX_DEFAULT_DOMAIN}
            - NEXTSTEP_APPLICATION_NAME=${NEXTSTEP_APPLICATION_NAME}
            - NEXTSTEP_APPLICATION_DISPLAY_NAME=${NEXTSTEP_APPLICATION_DISPLAY_NAME}
            - NEXTSTEP_APPLICATION_ENVIRONMENT=${NEXTSTEP_APPLICATION_ENVIRONMENT}
            - NEXTSTEP_LOGGING=${NEXTSTEP_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-webflow-postgresql:
                condition: service_healthy

    # PowerAuth TPP registry and consent engine
    powerauth-tpp-engine:
        image: powerauth/tpp-engine-arm64v8
        container_name: powerauth-tpp-engine
        ports:
            - "13060:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-tpp-engine"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - POWERAUTH_TPP_ENGINE_DATASOURCE_URL=${POWERAUTH_TPP_ENGINE_DATASOURCE_URL}
            - POWERAUTH_TPP_ENGINE_DATASOURCE_USERNAME=${POWERAUTH_TPP_ENGINE_DATASOURCE_USERNAME}
            - POWERAUTH_TPP_ENGINE_DATASOURCE_PASSWORD=${POWERAUTH_TPP_ENGINE_DATASOURCE_PASSWORD}
            - POWERAUTH_TPP_ENGINE_DATASOURCE_DRIVER=${POWERAUTH_TPP_ENGINE_DATASOURCE_DRIVER}
            - POWERAUTH_TPP_ENGINE_JPA_DDL_AUTO=${POWERAUTH_TPP_ENGINE_JPA_DDL_AUTO}
            - POWERAUTH_TPP_ENGINE_JPA_CHARSET=${POWERAUTH_TPP_ENGINE_JPA_CHARSET}
            - POWERAUTH_TPP_ENGINE_JPA_CHARACTER_ENCODING=${POWERAUTH_TPP_ENGINE_JPA_CHARACTER_ENCODING}
            - POWERAUTH_TPP_ENGINE_JPA_USE_UNICODE=${POWERAUTH_TPP_ENGINE_JPA_USE_UNICODE}
            - POWERAUTH_TPP_ENGINE_JPA_DATABASE_PLATFORM=${POWERAUTH_TPP_ENGINE_JPA_DATABASE_PLATFORM}
            - POWERAUTH_TPP_ENGINE_DATASOURCE_JNDI_NAME=${POWERAUTH_TPP_ENGINE_DATASOURCE_JNDI_NAME}
            - POWERAUTH_TPP_ENGINE_SPRING_JMX_ENABLED=${POWERAUTH_TPP_ENGINE_SPRING_JMX_ENABLED}
            - POWERAUTH_TPP_ENGINE_SPRING_JMX_DEFAULT_DOMAIN=${POWERAUTH_TPP_ENGINE_SPRING_JMX_DEFAULT_DOMAIN}
            - POWERAUTH_TPP_ENGINE_APPLICATION_NAME=${POWERAUTH_TPP_ENGINE_APPLICATION_NAME}
            - POWERAUTH_TPP_ENGINE_APPLICATION_DISPLAY_NAME=${POWERAUTH_TPP_ENGINE_APPLICATION_DISPLAY_NAME}
            - POWERAUTH_TPP_ENGINE_APPLICATION_ENVIRONMENT=${POWERAUTH_TPP_ENGINE_APPLICATION_ENVIRONMENT}
            - POWERAUTH_TPP_ENGINE_LOGGING=${POWERAUTH_TPP_ENGINE_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-webflow-postgresql:
                condition: service_healthy

    # PowerAuth Data Adapter
    powerauth-data-adapter:
        image: powerauth/data-adapter-arm64v8
        container_name: powerauth-data-adapter
        ports:
            - "13050:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-data-adapter"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - DATA_ADAPTER_DATASOURCE_URL=${DATA_ADAPTER_DATASOURCE_URL}
            - DATA_ADAPTER_DATASOURCE_USERNAME=${DATA_ADAPTER_DATASOURCE_USERNAME}
            - DATA_ADAPTER_DATASOURCE_PASSWORD=${DATA_ADAPTER_DATASOURCE_PASSWORD}
            - DATA_ADAPTER_DATASOURCE_DRIVER=${DATA_ADAPTER_DATASOURCE_DRIVER}
            - DATA_ADAPTER_JPA_DDL_AUTO=${DATA_ADAPTER_JPA_DDL_AUTO}
            - DATA_ADAPTER_JPA_CHARSET=${DATA_ADAPTER_JPA_CHARSET}
            - DATA_ADAPTER_JPA_CHARACTER_ENCODING=${DATA_ADAPTER_JPA_CHARACTER_ENCODING}
            - DATA_ADAPTER_JPA_USE_UNICODE=${DATA_ADAPTER_JPA_USE_UNICODE}
            - DATA_ADAPTER_JPA_DATABASE_PLATFORM=${DATA_ADAPTER_JPA_DATABASE_PLATFORM}
            - DATA_ADAPTER_SMS_EXPIRATION=${DATA_ADAPTER_SMS_EXPIRATION}
            - DATA_ADAPTER_SMS_MAX_TRIES=${DATA_ADAPTER_SMS_MAX_TRIES}
            - DATA_ADAPTER_DATASOURCE_JNDI_NAME=${DATA_ADAPTER_DATASOURCE_JNDI_NAME}
            - DATA_ADAPTER_SPRING_JMX_ENABLED=${DATA_ADAPTER_SPRING_JMX_ENABLED}
            - DATA_ADAPTER_SPRING_JMX_DEFAULT_DOMAIN=${DATA_ADAPTER_SPRING_JMX_DEFAULT_DOMAIN}
            - DATA_ADAPTER_APPLICATION_NAME=${DATA_ADAPTER_APPLICATION_NAME}
            - DATA_ADAPTER_APPLICATION_DISPLAY_NAME=${DATA_ADAPTER_APPLICATION_DISPLAY_NAME}
            - DATA_ADAPTER_APPLICATION_ENVIRONMENT=${DATA_ADAPTER_APPLICATION_ENVIRONMENT}
            - DATA_ADAPTER_LOGGING=${DATA_ADAPTER_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-tpp-engine:
                condition: service_healthy

    # PowerAuth Web Flow Server
    powerauth-webflow:
        image: powerauth/webflow-arm64v8
        container_name: powerauth-webflow
        ports:
            - "13030:8080"
        mem_limit: ${JAVA_PROCESS_MEMORY_LIMIT_OPENJDK_ARM64V8}
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8080/powerauth-webflow"]
            interval: 10s
            timeout: 10s
            retries: 30
        environment:
            - WEBFLOW_DATA_ADAPTER_URL=${WEBFLOW_DATA_ADAPTER_URL}
            - WEBFLOW_NEXTSTEP_URL=${WEBFLOW_NEXTSTEP_URL}
            - WEBFLOW_POWERAUTH_SERVICE_URL=${WEBFLOW_POWERAUTH_SERVICE_URL}
            - WEBFLOW_POWERAUTH_SECURITY_TOKEN=${WEBFLOW_POWERAUTH_SECURITY_TOKEN}
            - WEBFLOW_POWERAUTH_SECURITY_SECRET=${WEBFLOW_POWERAUTH_SECURITY_SECRET}
            - WEBFLOW_ACCEPT_INVALID_SSL_CERTIFICATE=${WEBFLOW_ACCEPT_INVALID_SSL_CERTIFICATE}
            - WEBFLOW_PUSH_SERVER_URL=${WEBFLOW_PUSH_SERVER_URL}
            - WEBFLOW_DATASOURCE_URL=${WEBFLOW_DATASOURCE_URL}
            - WEBFLOW_DATASOURCE_USERNAME=${WEBFLOW_DATASOURCE_USERNAME}
            - WEBFLOW_DATASOURCE_PASSWORD=${WEBFLOW_DATASOURCE_PASSWORD}
            - WEBFLOW_DATASOURCE_DRIVER=${WEBFLOW_DATASOURCE_DRIVER}
            - WEBFLOW_JPA_DDL_AUTO=${WEBFLOW_JPA_DDL_AUTO}
            - WEBFLOW_JPA_CHARSET=${WEBFLOW_JPA_CHARSET}
            - WEBFLOW_JPA_CHARACTER_ENCODING=${WEBFLOW_JPA_CHARACTER_ENCODING}
            - WEBFLOW_JPA_USE_UNICODE=${WEBFLOW_JPA_USE_UNICODE}
            - WEBFLOW_JPA_DATABASE_PLATFORM=${WEBFLOW_JPA_DATABASE_PLATFORM}
            - WEBFLOW_DATASOURCE_JNDI_NAME=${WEBFLOW_DATASOURCE_JNDI_NAME}
            - WEBFLOW_PAGE_TITLE=${WEBFLOW_PAGE_TITLE}
            - WEBFLOW_PAGE_EXT_RESOURCES_LOCATION=${WEBFLOW_PAGE_EXT_RESOURCES_LOCATION}
            - WEBFLOW_PAGE_CUSTOM_CSS_URL=${WEBFLOW_PAGE_CUSTOM_CSS_URL}
            - WEBFLOW_OFFLINE_MODE_AVAILABLE=${WEBFLOW_OFFLINE_MODE_AVAILABLE}
            - WEBFLOW_SHOW_SECURITY_WARNING_ANDROID=${WEBFLOW_SHOW_SECURITY_WARNING_ANDROID}
            - WEBFLOW_PASSWORD_PROTECTION_TYPE=${WEBFLOW_PASSWORD_PROTECTION_TYPE}
            - WEBFLOW_PASSWORD_ENCRYPTION_TRANSFORMATION=${WEBFLOW_PASSWORD_ENCRYPTION_TRANSFORMATION}
            - WEBFLOW_PASSWORD_ENCRYPTION_KEY=${WEBFLOW_PASSWORD_ENCRYPTION_KEY}
            - WEBFLOW_SMS_RESEND_DELAY_MS=${WEBFLOW_SMS_RESEND_DELAY_MS}
            - WEBFLOW_POWERAUTH_OPERATIONS_ENABLED=${WEBFLOW_POWERAUTH_OPERATIONS_ENABLED}
            - WEBFLOW_AFS_ENABLED=${WEBFLOW_AFS_ENABLED}
            - WEBFLOW_AFS_TYPE=${WEBFLOW_AFS_TYPE}
            - WEBFLOW_AFS_DETECT_IP_ADDRESS=${WEBFLOW_AFS_DETECT_IP_ADDRESS}
            - WEBFLOW_AFS_FORCE_IPV4=${WEBFLOW_AFS_FORCE_IPV4}
            - WEBFLOW_AFS_TM_COOKIES_DEVICE_TAG=${WEBFLOW_AFS_TM_COOKIES_DEVICE_TAG}
            - WEBFLOW_AFS_TM_COOKIES_SESSION_SID=${WEBFLOW_AFS_TM_COOKIES_SESSION_SID}
            - WEBFLOW_TIMEOUT_WARNING_DELAY_MS=${WEBFLOW_TIMEOUT_WARNING_DELAY_MS}
            - WEBFLOW_SECURITY_CORS_ENABLED=${WEBFLOW_SECURITY_CORS_ENABLED}
            - WEBFLOW_SECURITY_CORS_ALLOW_ORIGIN=${WEBFLOW_SECURITY_CORS_ALLOW_ORIGIN}
            - WEBFLOW_SPRING_JMX_ENABLED=${WEBFLOW_SPRING_JMX_ENABLED}
            - WEBFLOW_SPRING_JMX_DEFAULT_DOMAIN=${WEBFLOW_SPRING_JMX_DEFAULT_DOMAIN}
            - WEBFLOW_APPLICATION_NAME=${WEBFLOW_APPLICATION_NAME}
            - WEBFLOW_APPLICATION_DISPLAY_NAME=${WEBFLOW_APPLICATION_DISPLAY_NAME}
            - WEBFLOW_APPLICATION_ENVIRONMENT=${WEBFLOW_APPLICATION_ENVIRONMENT}
            - WEBFLOW_LOGGING=${WEBFLOW_LOGGING}
            - JAVA_OPTS=${POWERAUTH_JAVA_OPTS_OPENJDK_ARM64V8}
        depends_on:
            powerauth-webflow-postgresql:
                condition: service_healthy
            powerauth-nextstep:
                condition: service_healthy
            powerauth-data-adapter:
                condition: service_healthy
            powerauth-java-server:
                condition: service_healthy
